<!DOCTYPE html>
<html>
<head>
	<link type="text/css" rel="stylesheet" href="/css/base.css">
	<script type="text/javascript" src="/js/module.js"></script>
	<title></title>
</head>
<body>
<div id="container">
	<div id="header">
		<div id="logo"></div>
	</div>

	<h1>Выбери с кем играть</h1>

	<div id="players"></div>

	<div id="gameArea">
		<div class="left player">
			<div class="photo" style="background-image: url(http://cs10515.vk.me/u142696085/a_b94a241e.jpg)"></div>
			<div class="name">Name</div>
			<div class="result"></div>
		</div>
		<div class="right player">
			<div class="photo" style="background-image: url(http://cs4548.vk.me/u41849461/a_aafceca2.jpg)"></div>
			<div class="name">Name</div>
			<div class="result"></div>
		</div>
		<div class="question">
			<div class="type">Характер</div>
			<div class="text">Ты любишь цветы?</div>
			<div class="answers">
				<div class="result"></div>
				<div class="btns">
					<div data-id="1" class="btn yes">Да</div>
					<div data-id="2" class="btn no">Нет</div>
				</div>
				<div class="wait">Ждем ответа от другого игрока</div>
			</div>
		</div>
	</div>

	<h2>Приглашают тебя играть</h2>
	<div id="invites">
		<div class="empty">Пока тебя никто не приглашал</div>
	</div>
</div>
<script>
var module = new Module('/js/');
module.define(['base', 'game'], '', function(base, game){
	var
	ws = new base.WS(new WebSocket('ws://192.168.56.101:8080/game')),
	paramsArr = decodeURIComponent(window.location.search.slice(1)).split('&'),
	params = {};

	for (var i = 0; i < paramsArr.length; i++) {
		var tmparr = paramsArr[i].split('=');
		params[tmparr[0]] = tmparr[1];
	}
	var userData = JSON.parse(params['api_result']).response[0];
	console.log(userData);

	ws.onmessage = function(data){
		if (!data.players) {
			return;
		}
		delete ws.onmessage;
		var g = new game.Game(ws, data.player, data.players);
	};

	ws.onopen = function(){
		ws.send({
			method: 'login',
			name: userData.screen_name,
			photo: userData.photo_200_orig,
			gender: (userData.sex == 2 ? 1 : 0)
		});
	};
});
</script>
</body>
</html>